\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{graphicx, xspace, cite, url}
\usepackage[margin=1in
  %,showframe% <- only to show the page layout
]{geometry}
\usepackage[draft=false]{hyperref}
\hypersetup{%
  colorlinks=true,      % false: boxed links; true: colored links
  linkcolor=blue,       % color of internal links
  citecolor=magenta,    % color of links to bibliography
  filecolor=cyan,       % color of file links
  urlcolor=blue          % color of external links
}
\usepackage[hyperref]{backref}
\usepackage[anythingbreaks]{breakurl}
\usepackage{etoolbox}
\appto\UrlBreaks{\do\-}
\usepackage[htt]{hyphenat}

\usepackage{inconsolata} % causes some error?
\usepackage{csquotes}
\usepackage{epigraph}

%\usepackage{fancyvrb}
%\usepackage{booktabs}
%\usepackage{tabu}
%\usepackage{tabularx}
%\usepackage{paralist}

% more colors (like RedOrange)
\usepackage[dvipsnames]{xcolor}

% qualitative colors
% subset of https://jfly.uni-koeln.de/color/
% that is also distinctive in grayscale
\definecolor{set1}{HTML}{0071b2} % blue
\definecolor{set2}{HTML}{e59c00} % orange
\definecolor{set3}{HTML}{009e73} % green
\definecolor{set4}{HTML}{efe440} % yellow

% so we can splice in PDFs
\usepackage{pdfpages}

% set up bibliography
%\usepackage[
%  backend=bibtex,
%  sortcites=true,
%  sorting=ynt,
%  abbreviate=false,
%  style=numeric,
%  citestyle=numeric,
%  isbn=false,
%  url=false,
%  doi=false]{biblatex}
%\addbibresource{bibliography.bib}

% enumerate* and itemize*
\usepackage[inline]{enumitem}

% for \begin{comment}
\usepackage{verbatim}

% for source-code listings
\usepackage[newfloat,draft=false]{minted}

% for formulas
\usepackage{mathtools}

% to split lists into multiple columns
\usepackage{multicol}

% for "on page NN" reference
%\usepackage[nospace]{varioref}

% for \sfrac
\usepackage{xfrac}

% for \ifoptionfinal
\usepackage{ifdraft}

\usepackage{subcaption}
\captionsetup[subfigure]{skip=-1pt,font={footnotesize}}

% do not reset page numbers at \mainmatter
\let\mainmatterorig\mainmatter
\renewcommand\mainmatter
 {\edef\p{\arabic{page}}%
  \mainmatterorig
  % we need to compute the actual current page number. we know the page number
  % from _before_ we called \mainmatter. but what is it now? well, it is
  % certainly that +1. but we also need to account for the next chapter starting
  % on a "right" (odd) page. we do this by adding the page number modulo two.
  % TODO: double check before final version
  \setcounter{page}{\p+1+(\p-\p/2*2)}%
 }

% an environment for todos
\newenvironment{inprogress}
  {\vspace{.5em} \color{set2} \noindent \textbf{TODO}}
  {\vspace{.5em}}

% a command to indicate current editing progress
\newcommand{\resume}{
  \begin{center}
    \color{set2}
    \hrule
    \vspace{1pt}
    \hrule
    \hrule
    \vspace{10pt}
    \textbf{This section is not yet complete.}
    \vspace{10pt}
    \hrule
    \hrule
    \vspace{1pt}
    \hrule
  \end{center}
}

% an environment for invariants
\newcounter{invn}
\renewcommand{\theinvn}{\Roman{invn}}
\newenvironment{invariant}
  {\vspace{.5em} \color{set1} \refstepcounter{invn} \noindent \textbf{\color{set1} Invariant \Roman{invn}.}}
  {\vspace{.5em}}

% for handy reference
%
% paragraph without spacing:
% \setparsizes{0pt}{0pt}{0pt plus 1fil}

  %% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%
\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX
\usepackage{alltt}

\interfootnotelinepenalty=10000

\renewcommand{\floatpagefraction}{.7}
\setcounter{topnumber}{2}
\setcounter{bottomnumber}{2}
\usepackage{afterpage}
\usepackage{placeins}

\newcommand{\cut}[1]{}
%
\newcommand{\paragrapha}[1]{\vspace{0.05in}\noindent\textbf{#1}.}
\newcommand{\paragraphi}[1]{\noindent\textit{#1.}}
\newcommand{\paragraphn}[1]{\noindent\textit{#1}}
\newcommand{\ct}[1]{{\texttt{#1}}}
\newcommand{\Para}[1]{\vspace{4pt}\noindent\textbf{#1}}
\newcommand{\Sec}[1]{\S\ref{#1}}
%
\newcommand{\eg}{e.g., }
\newcommand{\etc}{{etc.}\xspace}
\newcommand{\ie}{i.e., }
\newcommand{\ccp}{CCP\xspace}
%
\newcommand{\datapath}{datapath\xspace}
\newcommand{\datapaths}{datapaths\xspace}
\newcommand{\Datapaths}{Datapaths\xspace}
\newcommand{\Datapath}{Datapath\xspace}
\newcommand{\handlers}{callbacks\xspace}
\newcommand{\userspace}{user-space\xspace}
\newcommand{\kernelspace}{kernel-space\xspace}
%
\newcommand{\controller}{agent\xspace}

\def\etal{et al.\xspace}
\def\us{$\mu$s\xspace}
\newcommand{\name}{Bertha\xspace} % Bertha
\newcommand{\tunnel}{Chunnel\xspace}
\newcommand{\tunnels}{Chunnels\xspace}
\newcommand{\canonicaladdr}{canonical address}
\newcommand{\Canonicaladdr}{Canonical address}
\newcommand{\eat}[1]{}
\date{}
%\usepackage{titling}\setlength{\droptitle}{-1cm}
\hypersetup{pdfstartview=FitH,pdfpagelayout=SinglePage}

\def\Alice{Alice Appwright\xspace}
\def\Isabelle{Chani Chunnelbuild\xspace}
\def\Octavia{Ophelia Optimizestack\xspace}
\def\fAlice{Alice\xspace}
\def\fIsabelle{Chani\xspace}
\def\fOctavia{Ophelia\xspace}
\def\implib{\tunnel-implementation library\xspace}
\def\optlib{connection optimization library\xspace}
\def\optlibs{connection optimization libraries\xspace}
\def\optimization{stack pass\xspace}
\def\optimizations{stack passes\xspace}
